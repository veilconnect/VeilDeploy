# VeilDeploy ç”¨æˆ·ä½¿ç”¨æŒ‡å—

## ğŸ¯ VeilDeploy æ˜¯ä»€ä¹ˆï¼Ÿ

VeilDeploy æ˜¯ä¸€ä¸ª**å®‰å…¨åŠ å¯†éš§é“è½¯ä»¶**ï¼Œç±»ä¼¼äº VPNï¼Œæä¾›ï¼š
- ğŸ” ç«¯åˆ°ç«¯åŠ å¯†é€šä¿¡
- ğŸŒ ç‚¹å¯¹ç‚¹ç½‘ç»œéš§é“
- ğŸš€ é«˜æ€§èƒ½æ•°æ®ä¼ è¾“
- ğŸ“Š å®æ—¶ç›‘æ§å’Œç®¡ç†

## ğŸ“¦ ä¸‰ç§ä½¿ç”¨æ–¹å¼

### æ–¹å¼1ï¸âƒ£: å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

é€‚åˆæœåŠ¡å™¨éƒ¨ç½²å’Œè‡ªåŠ¨åŒ–åœºæ™¯ã€‚

#### æœåŠ¡å™¨ç«¯
```bash
# å¯åŠ¨æœåŠ¡å™¨
./veildeploy.exe -config config.json

# æˆ–æŒ‡å®šæ¨¡å¼
./veildeploy.exe -config config.json -mode server
```

#### å®¢æˆ·ç«¯
```bash
# å¯åŠ¨å®¢æˆ·ç«¯
./veildeploy.exe -config client-config.json -mode client
```

---

### æ–¹å¼2ï¸âƒ£: æ¡Œé¢ GUIï¼ˆæ¨èæ™®é€šç”¨æˆ·ï¼‰

æä¾›å¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼Œç®€å•æ˜“ç”¨ã€‚

```bash
# å¯åŠ¨ GUI
./veildeploy-gui.exe

# è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8080
```

**GUI åŠŸèƒ½**:
- âœ… å¯è§†åŒ–é…ç½®ç¼–è¾‘
- âœ… ä¸€é”®å¯åŠ¨/åœæ­¢æœåŠ¡
- âœ… å®æ—¶çŠ¶æ€ç›‘æ§
- âœ… å›¾å½¢åŒ–ç»Ÿè®¡é¢æ¿

![GUI Screenshot](gui-preview.png)

---

### æ–¹å¼3ï¸âƒ£: ç®¡ç† APIï¼ˆå¼€å‘è€…ï¼‰

é€šè¿‡ HTTP API ç®¡ç†å’Œç›‘æ§æœåŠ¡ã€‚

```bash
# æŸ¥çœ‹çŠ¶æ€
curl http://127.0.0.1:7777/state

# æŸ¥çœ‹æŒ‡æ ‡
curl http://127.0.0.1:7777/metrics
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åœºæ™¯1: æœ¬åœ°æµ‹è¯•ï¼ˆæœ€ç®€å•ï¼‰

**æ­¥éª¤1**: å¯åŠ¨æœåŠ¡å™¨
```bash
./veildeploy.exe -config config.json
```

**æ­¥éª¤2**: æ–°å¼€ç»ˆç«¯å¯åŠ¨å®¢æˆ·ç«¯
```bash
./veildeploy.exe -config client-config.json -mode client
```

**æ­¥éª¤3**: æŸ¥çœ‹è¿æ¥çŠ¶æ€
```bash
# æœåŠ¡å™¨çŠ¶æ€
curl http://127.0.0.1:7777/state

# å®¢æˆ·ç«¯çŠ¶æ€
curl http://127.0.0.1:7778/state
```

âœ… **æˆåŠŸæ ‡å¿—**: çœ‹åˆ° "handshake complete" å’Œç›¸åŒçš„ sessionId

---

### åœºæ™¯2: è¿œç¨‹éƒ¨ç½²

#### æœåŠ¡å™¨é…ç½® (config.json)
```json
{
  "mode": "server",
  "listen": "0.0.0.0:51820",  // ç›‘å¬æ‰€æœ‰ç½‘å¡
  "psk": "your-secure-random-32-byte-psk-here",
  "peers": [
    {
      "name": "client1",
      "allowedIPs": ["10.0.0.0/24"]
    }
  ],
  "tunnel": {
    "type": "loopback"  // æˆ– "tun" ç”¨äºçœŸå®ç½‘ç»œ
  }
}
```

#### å®¢æˆ·ç«¯é…ç½® (client-config.json)
```json
{
  "mode": "client",
  "endpoint": "your-server-ip:51820",  // æœåŠ¡å™¨å…¬ç½‘ IP
  "psk": "your-secure-random-32-byte-psk-here",  // ä¸æœåŠ¡å™¨ç›¸åŒ
  "peers": [
    {
      "name": "server",
      "allowedIPs": ["10.0.0.0/24"]
    }
  ],
  "tunnel": {
    "type": "loopback"
  }
}
```

---

## ğŸ“– é…ç½®æ–‡ä»¶è¯¦è§£

### åŸºæœ¬é…ç½®

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `mode` | è¿è¡Œæ¨¡å¼ | `"server"` æˆ– `"client"` |
| `listen` | ç›‘å¬åœ°å€ï¼ˆæœåŠ¡å™¨ï¼‰ | `"0.0.0.0:51820"` |
| `endpoint` | æœåŠ¡å™¨åœ°å€ï¼ˆå®¢æˆ·ç«¯ï¼‰ | `"server.com:51820"` |
| `psk` | é¢„å…±äº«å¯†é’¥ï¼ˆå¿…é¡»ç›¸åŒï¼‰| è‡³å°‘16å­—ç¬¦ |

### Tunnel é…ç½®

| ç±»å‹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `loopback` | å›ç¯æµ‹è¯• | å¼€å‘å’Œæµ‹è¯• |
| `udp-bridge` | UDPæ¡¥æ¥ | åº”ç”¨å±‚éš§é“ |
| `tun` | TUNè®¾å¤‡ | çœŸå®VPNç½‘ç»œ |

### TUN æ¨¡å¼é…ç½®ï¼ˆé«˜çº§ï¼‰

```json
{
  "tunnel": {
    "type": "tun",
    "name": "stp0",           // æ¥å£åç§°
    "mtu": 1420,              // MTUå¤§å°
    "address": "10.0.0.1/24", // æœ¬åœ°IP
    "autoConfigure": true,    // è‡ªåŠ¨é…ç½®
    "routes": [               // é¢å¤–è·¯ç”±
      "192.168.0.0/16"
    ]
  }
}
```

---

## ğŸ“Š å®æ—¶ç›‘æ§

### æœåŠ¡å™¨çŠ¶æ€

å½“å‰è¿æ¥ï¼š
```json
{
  "server": {
    "sessions": 1,           // æ´»è·ƒä¼šè¯æ•°
    "currentConnections": 1, // å½“å‰è¿æ¥æ•°
    "maxConnections": 1000,  // æœ€å¤§è¿æ¥æ•°
    "availableTokens": 9     // å¯ç”¨ä»¤ç‰Œ
  }
}
```

### å®¢æˆ·ç«¯çŠ¶æ€

```json
{
  "device": {
    "role": "client",
    "sessionId": "a8cd9712...",  // ä¼šè¯ID
    "messages": 15,              // æ¶ˆæ¯è®¡æ•°
    "peers": [{
      "name": "server",
      "endpoint": "127.0.0.1:51820",
      "lastHandshake": "2025-09-30T22:19:23Z"
    }]
  }
}
```

---

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹æ—¥å¿—

æœåŠ¡è¿è¡Œæ—¶ä¼šè¾“å‡ºç»“æ„åŒ–æ—¥å¿—ï¼š

```json
{"level":"info","message":"handshake complete","sessionId":"a8cd9712..."}
{"level":"info","message":"session added","session":1}
```

æ—¥å¿—çº§åˆ«ï¼š`error` < `warn` < `info` < `debug`

### çƒ­é‡è½½é…ç½®

ä¿®æ”¹ `config.json` åï¼Œ5ç§’å†…è‡ªåŠ¨åº”ç”¨ï¼ˆæ— éœ€é‡å¯ï¼‰ï¼š

æ”¯æŒçƒ­é‡è½½çš„å‚æ•°ï¼š
- âœ… `management.acl` - ç®¡ç†ACL
- âœ… `logging.level` - æ—¥å¿—çº§åˆ«
- âœ… `peers` - Peeré…ç½®
- âœ… `maxConnections` - è¿æ¥é™åˆ¶
- âœ… `connectionRate` - é€Ÿç‡é™åˆ¶

### åœæ­¢æœåŠ¡

```bash
# Ctrl+C æˆ–å‘é€ SIGTERM
kill <pid>
```

æœåŠ¡ä¼šä¼˜é›…å…³é—­ï¼Œç­‰å¾…ç°æœ‰ä¼šè¯ç»“æŸã€‚

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ä½¿ç”¨å¼ºPSK

âŒ **ä¸è¦ä½¿ç”¨**:
- é»˜è®¤å€¼
- çŸ­å¯†ç ï¼ˆ< 16å­—ç¬¦ï¼‰
- ç®€å•å¯†ç 

âœ… **æ¨è**:
```bash
# ç”Ÿæˆå®‰å…¨çš„PSK
openssl rand -base64 32

# æˆ–ä½¿ç”¨
head /dev/urandom | tr -dc A-Za-z0-9 | head -c 32
```

### 2. é™åˆ¶ç®¡ç†æ¥å£

```json
{
  "management": {
    "bind": "127.0.0.1:7777",  // åªç›‘å¬æœ¬åœ°
    "acl": ["127.0.0.0/8"]     // åªå…è®¸æœ¬åœ°è®¿é—®
  }
}
```

### 3. å¯ç”¨é˜²ç«å¢™

```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
ufw allow 51820/udp
ufw deny 7777
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: å®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨

**æ£€æŸ¥**:
```bash
# 1. æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
curl http://server-ip:7777/state

# 2. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾
telnet server-ip 51820

# 3. PSKæ˜¯å¦åŒ¹é…
grep psk config.json client-config.json
```

### é—®é¢˜2: ç«¯å£è¢«å ç”¨

```
Error: listen udp :51820: bind: address already in use
```

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
netstat -ano | findstr :51820

# åœæ­¢è¿›ç¨‹æˆ–æ›´æ¢ç«¯å£
```

### é—®é¢˜3: æ¡æ‰‹å¤±è´¥

```
Error: handshake failed: authentication failed
```

**åŸå› **: PSKä¸åŒ¹é…

**è§£å†³**: ç¡®ä¿æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„PSK

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### è°ƒæ•´MTU

```json
{
  "tunnel": {
    "mtu": 1420  // é»˜è®¤å€¼ï¼Œæ ¹æ®ç½‘ç»œè°ƒæ•´
  }
}
```

ç½‘ç»œç¯å¢ƒå»ºè®®ï¼š
- å±€åŸŸç½‘: 1500
- äº’è”ç½‘: 1420
- ç§»åŠ¨ç½‘ç»œ: 1280

### è¿æ¥é™åˆ¶

```json
{
  "maxConnections": 1000,    // æœ€å¤§è¿æ¥æ•°
  "connectionRate": 100,     // æ¯åˆ†é’Ÿæ–°è¿æ¥æ•°
  "connectionBurst": 10      // çªå‘è¿æ¥æ•°
}
```

### Keepalive é—´éš”

```json
{
  "keepalive": "15s"  // ä¿æ´»é—´éš”ï¼Œå»ºè®®5-30ç§’
}
```

---

## ğŸ“ é«˜çº§åŠŸèƒ½

### å¤šPeeré…ç½®

```json
{
  "peers": [
    {"name": "client1", "allowedIPs": ["10.0.1.0/24"]},
    {"name": "client2", "allowedIPs": ["10.0.2.0/24"]},
    {"name": "client3", "allowedIPs": ["10.0.3.0/24"]}
  ]
}
```

### Rekeyé…ç½®

```json
{
  "rekeyInterval": "30m",  // 30åˆ†é’Ÿé‡æ–°å¯†é’¥
  "rekeyBudget": 16000     // æˆ–16000æ¡æ¶ˆæ¯å
}
```

### æ—¥å¿—è¾“å‡º

```json
{
  "logging": {
    "level": "info",        // error/warn/info/debug
    "output": "stdout"      // stdout æˆ–æ–‡ä»¶è·¯å¾„
  }
}
```

---

## ğŸ“ å¸®åŠ©å’Œæ”¯æŒ

### å‘½ä»¤è¡Œå¸®åŠ©

```bash
./veildeploy.exe -h
```

### é…ç½®éªŒè¯

```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶
./veildeploy.exe -config config.json -mode server &
sleep 2
curl http://127.0.0.1:7777/state
kill $!
```

### æŸ¥çœ‹ç‰ˆæœ¬

```bash
./veildeploy.exe -version
```

---

## ğŸ“š ç¤ºä¾‹åœºæ™¯

### åœºæ™¯A: ç®€å•ç‚¹å¯¹ç‚¹

**ç”¨é€”**: ä¸¤å°ç”µè„‘ä¹‹é—´åŠ å¯†é€šä¿¡

**æœåŠ¡å™¨** (ç”µè„‘A):
```bash
./veildeploy.exe -config config.json
```

**å®¢æˆ·ç«¯** (ç”µè„‘B):
```bash
./veildeploy.exe -config client-config.json -mode client
```

### åœºæ™¯B: å¤šå®¢æˆ·ç«¯è®¿é—®

**æœåŠ¡å™¨** (ä¸­å¿ƒæœåŠ¡å™¨):
```json
{
  "mode": "server",
  "listen": "0.0.0.0:51820",
  "peers": [
    {"name": "laptop", "allowedIPs": ["10.0.0.10/32"]},
    {"name": "phone", "allowedIPs": ["10.0.0.20/32"]},
    {"name": "tablet", "allowedIPs": ["10.0.0.30/32"]}
  ]
}
```

æ¯ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨è‡ªå·±çš„é…ç½®æ–‡ä»¶è¿æ¥ã€‚

### åœºæ™¯C: TUNæ¨¡å¼çœŸå®VPN

**æœåŠ¡å™¨**:
```json
{
  "tunnel": {
    "type": "tun",
    "name": "stp0",
    "address": "10.0.0.1/24",
    "autoConfigure": true
  }
}
```

**å®¢æˆ·ç«¯**:
```json
{
  "tunnel": {
    "type": "tun",
    "name": "stp0",
    "address": "10.0.0.2/24",
    "autoConfigure": true,
    "routes": ["192.168.0.0/16"]  // è·¯ç”±å†…ç½‘æµé‡
  }
}
```

---

## ğŸ‰ æ€»ç»“

VeilDeploy æä¾›ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š

1. **å‘½ä»¤è¡Œ** - æœåŠ¡å™¨éƒ¨ç½²ï¼Œè‡ªåŠ¨åŒ–
2. **GUI** - ç®€å•æ˜“ç”¨ï¼Œå¯è§†åŒ–ç®¡ç†
3. **API** - ç¼–ç¨‹é›†æˆï¼Œç›‘æ§å‘Šè­¦

é€‰æ‹©é€‚åˆæ‚¨çš„æ–¹å¼ï¼Œå¼€å§‹ä½¿ç”¨å®‰å…¨åŠ å¯†éš§é“ï¼

**å…³é”®è¦ç‚¹**:
- âœ… PSKå¿…é¡»åŒ¹é…
- âœ… é˜²ç«å¢™å¼€æ”¾ç«¯å£
- âœ… æŸ¥çœ‹æ—¥å¿—æ’æŸ¥é—®é¢˜
- âœ… ä½¿ç”¨ç®¡ç†APIç›‘æ§

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹æ–‡æ¡£æˆ–æäº¤ Issueã€‚